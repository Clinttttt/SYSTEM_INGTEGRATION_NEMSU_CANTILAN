@inject IStudentRecordApiCommand studentRecordCommand
@inject IJSRuntime JS
<dialog id="my_modal_2" class="modal">

    <EditForm Model="@studentUpdateInformation" OnValidSubmit="@HandlingEdit" FormName="editstudentinfo" class="space-y-6">
        <div class="modal-box w-11/12 max-w-5xl max-h-[90vh] p-0 overflow-hidden rounded-md">

            <div class="bg-gradient-to-r from-cyan-600 to-teal-700 p-6 sticky top-0 z-10">
                <h3 class="text-2xl font-bold text-white">Edit Student Details</h3>
                <p class="text-teal-100 text-sm mt-1">Update your personal and academic information</p>
            </div>


            <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">





                @if (studentUpdateInformation?.personalInformation is not null)
                {

                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
                        <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">1</span>
                            Personal Information
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                <input type="text" @bind="studentUpdateInformation.personalInformation.FirstName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Middle Name</label>
                                <input type="text" @bind="studentUpdateInformation.personalInformation.MiddleName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                <input type="text" @bind="studentUpdateInformation.personalInformation.LastName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                                <input type="date" @bind="studentUpdateInformation.personalInformation.DateOfBirth" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                                <select @bind="studentUpdateInformation.personalInformation.Gender" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="@GenderChoice.Male" selected>Male</option>
                                    <option value="@GenderChoice.Female">Female</option>
                                    <option value="@GenderChoice.Prefer_not_to_say">Prefer not to say</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Civil Status</label>
                                <select @bind="studentUpdateInformation.personalInformation.CivilStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="@CivilStatusChoice.Single">Single</option>
                                    <option value="@CivilStatusChoice.Taken">Taken</option>
                                    <option value="@CivilStatusChoice.Married">Married</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nationality</label>
                                <input type="text" @bind="studentUpdateInformation.personalInformation.Nationality" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" />
                            </div>
                        </div>
                    </div>
                }

                @if (studentUpdateInformation?.contactInformation is not null && studentUpdateInformation.personalInformation is not null)
                {
                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
                        <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">2</span>
                            Contact Information
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Permanent Address</label>
                                <textarea rows="2" @bind="studentUpdateInformation.personalInformation.PermanentAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">P4 Sanvicente Carmen Surigao del Sur</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
                                <input type="tel" @bind="studentUpdateInformation.contactInformation.MobileNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                <input type="email" @bind="studentUpdateInformation.contactInformation.EmailAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500" />
                            </div>
                        </div>
                    </div>
                }


                @if (studentUpdateInformation?.academicInformation is not null)
                {
                    <div class="bg-gray-50 rounded-lg p-5 border border-gray-200">
                        <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">3</span>
                            Academic Information
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Student Type</label>
                                <select @bind="studentUpdateInformation.academicInformation.StudentType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="@StudentTypeChoice.New">New Student</option>
                                    <option value="@StudentTypeChoice.Transferee" selected>Transferee</option>
                                    <option value="@StudentTypeChoice.Returning">Returnee</option>
                                    <option value="@StudentTypeChoice.Old">Old Student</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Year Level</label>
                                <select @bind="studentUpdateInformation.academicInformation.YearLevel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="@YearLevelChoice.First_Year">1st Year</option>
                                    <option value="@YearLevelChoice.Second_Year">2nd Year</option>
                                    <option value="@YearLevelChoice.Third_Year">3rd Year</option>
                                    <option value="@YearLevelChoice.Fourth_Year">4th Year</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Semester</label>
                                <select @bind="studentUpdateInformation.academicInformation.Semester" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="@SemesterChoice.First_Semester">1st Semester</option>
                                    <option value="@SemesterChoice.Second_Semester">2nd Semester</option>

                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">SHS Strand</label>
                                <select @bind="studentUpdateInformation.academicInformation.Strand" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="@StrandChoice.Stem">STEM</option>
                                    <option value="@StrandChoice.Abm">ABM</option>
                                    <option value="@StrandChoice.Humss">HUMSS</option>
                                    <option value="@StrandChoice.Gas">GAS</option>
                                    <option value="@StrandChoice.Tvl" selected>TVL</option>
                                </select>
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Program</label>
                                <select @bind="studentUpdateInformation.academicInformation.Program" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="@ProgramChoice.Criminology">College of Criminal Justice Education</option>
                                    <option value="@ProgramChoice.Hospitality_Management">Bachelor of Science in Hospitality Management</option>
                                    <option value="@ProgramChoice.Business_Administration">Bachelor of Science in Business Administration</option>
                                    <option value="@ProgramChoice.Tourism_Management">Bachelor of Science in Tourism Management</option>
                                    <option value="@ProgramChoice.Industrial_Technology">Bachelor of Science in Industrial Technology</option>
                                    <option value="@ProgramChoice.Computer_Engineering">Bachelor of Science in Computer Engineering</option>
                                    <option value="@ProgramChoice.Computer_Science">Bachelor of Science in Computer Science</option>
                                    <option value="@ProgramChoice.Computer_Technology" selected>Bachelor of Science in Computer Technology</option>
                                    <option value="@ProgramChoice.Secondary_Education">Bachelor of Science in Secondary Education</option>
                                    <option value="@ProgramChoice.Technology_AndLivelihood_Education">Bachelor of Science in Technology And Livelihood Education</option>
                                    <option value="@ProgramChoice.Technical_Vocational_TeacherEducation">Bachelor of Science in Technical Vocational Teacher Education</option>
                                </select>
                            </div>
                        </div>
                    </div>
                }


            </div>


            <div class="bg-gray-50 border-t border-gray-200 p-5 flex justify-end gap-3 sticky bottom-0">
                <form method="dialog">
                    <button class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors font-medium">
                        Cancel
                    </button>
                </form>
                <button type="submit" class="px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                    Save Changes
                </button>
            </div>
        </div>
    </EditForm>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
@code {
    [Parameter]
    public IEnumerable<PersonalInformationDto>? PersonalInformation { get; set; }
    [Parameter]
    public IEnumerable<AcademicInformationDto>? AcademicInformation { get; set; }
    [Parameter]
    public IEnumerable<ContactInformationDto>? ContactInformation { get; set; }
    public bool hasrender = false;
    public StudentUpdateInformationDto studentUpdateInformation = new StudentUpdateInformationDto
        {
            personalInformation = new PersonalInformationDto(),
            contactInformation = new ContactInformationDto(),
            academicInformation = new AcademicInformationDto()

        };

    [Parameter]
    public EventCallback UpdateInformation {get;set;}
    public bool hasloaded = false;
    protected override void OnParametersSet()
    {

        if (!hasloaded && PersonalInformation is not null && AcademicInformation is not null && ContactInformation is not null )
        {
            foreach (var P in PersonalInformation)
            {
                foreach (var C in ContactInformation)
                {
                    foreach (var A in AcademicInformation)
                    {

                        studentUpdateInformation.personalInformation!.FirstName = P.FirstName;
                        studentUpdateInformation.personalInformation!.MiddleName = P.MiddleName;
                        studentUpdateInformation.personalInformation.LastName = P.LastName;
                        studentUpdateInformation.personalInformation.DateOfBirth = P.DateOfBirth;
                        studentUpdateInformation.personalInformation.Gender = P.Gender;
                        studentUpdateInformation.personalInformation.CivilStatus = P.CivilStatus;
                        studentUpdateInformation.personalInformation.Nationality = P.Nationality;
                        studentUpdateInformation.personalInformation.PermanentAddress = P.PermanentAddress;
                        studentUpdateInformation.contactInformation!.MobileNumber = C.MobileNumber;
                        studentUpdateInformation.contactInformation.EmailAddress = C.EmailAddress;
                        studentUpdateInformation.academicInformation!.StudentType = A.StudentType;
                        studentUpdateInformation.academicInformation.YearLevel = A.YearLevel;
                        studentUpdateInformation.academicInformation.Semester = A.Semester;
                        studentUpdateInformation.academicInformation.Strand = A.Strand;
                        studentUpdateInformation.academicInformation.Program = A.Program;
                    }
                }
            }
            hasloaded = true;
            StateHasChanged();
        }

    }

    public async Task HandlingEdit()
    {
        await studentRecordCommand.UpdateAllDetailsAsync(studentUpdateInformation!);
      
        await JS.InvokeVoidAsync("dialogHelper.closeDialog", "my_modal_2");
        await UpdateInformation.InvokeAsync();

    }
}