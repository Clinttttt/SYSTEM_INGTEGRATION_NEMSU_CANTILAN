
@page "/enrollmentdetails/{CouresId:guid}"
@inject IStudentRecordApiCommand studentRecordCommand
@inject IEnrollmentApiServices enrollmentApiServices
@rendermode InteractiveServer

<div class="overflow-auto lg:overflow-hidden  relative h-screen content ">
    <div class="drawer lg:drawer-open h-screen">
        <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
        <div class="drawer-content flex flex-col items-center justify-center">

            <label for="my-drawer-2" class="btn btn-primary drawer-button lg:hidden">
                Open drawer
            </label>





            <div class="flex w-full  flex-col lg:flex-row flex justify-start items-start w-full p-4 gap-3 overflow-auto h-screen">
              
                <div class="w-[100%] lg:w-[45%] h-[90%] bg-white rounded-lg shadow-md overflow-y-auto  ">

                    <div class="sticky relative h-25 top-0 bg-gradient-to-r from-cyan-600 to-teal-700 p-6 rounded-t-lg">
                        <div class="flex  justify-between items-center mb-2">
                            <h1 class="text-2xl font-bold mb-1 text-white">Enrollment Form</h1>
                            <button onclick="my_modal_2.showModal()" class="btn bg-white text-teal-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors font-medium text-sm">
                                Edit Details
                            </button>
                        </div>
                        <p class="text-teal-100 absolute bottom-5 text-sm">Academic Year 2024-2025</p>
                    </div>
                
                  
                    <div class="p-6 space-y-6">

                        @if (!hasrender)
                        {
                            <div class="flex justify-center items-center py-32">
                                <div class="text-center">
                                    <div class="relative">
                                        <div class="w-20 h-20 border-4 border-cyan-200 border-t-cyan-600 rounded-full animate-spin mx-auto"></div>
                                    </div>
                                    <p class="text-gray-600 mt-6 text-lg font-semibold">Loading Information...</p>
                                </div>
                            </div>
                        }
                        @if (PersonalInformation is not null)
                        {
                            foreach (var P in PersonalInformation)
                            {


                                <div class="border-b border-gray-200 pb-6">
                                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                        <span class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">1</span>
                                        Personal Information
                                    </h2>
                                    <div class="space-y-3">
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Full Name:</span>
                                            <span class="text-gray-800 flex-1 font-medium">@P.FirstName &nbsp @P.MiddleName, &nbsp @P.LastName</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Date of Birth:</span>
                                            <span class="text-gray-800 flex-1">@P.DateOfBirth.ToString("MM/dd/yyyy")</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Gender:</span>
                                            <span class="text-gray-800 flex-1">@P.Gender.GetDisplayName()</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Civil Status:</span>
                                            <span class="text-gray-800 flex-1">@P.CivilStatus.GetDisplayName()</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Nationality:</span>
                                            <span class="text-gray-800 flex-1">@P.Nationality</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        @if (ContactInformation is not null && PersonalInformation is not null)
                        {
                            foreach (var P in PersonalInformation)
                            {
                                foreach (var C in ContactInformation)
                                {
                                    
                                    <div class="border-b border-gray-200 pb-6">
                                        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                            <span class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">2</span>
                                            Contact Information
                                        </h2>
                                        <div class="space-y-3">
                                            <div class="flex">
                                                <span class="text-gray-500 w-32 text-sm font-medium">Address:</span>
                                                <span class="text-gray-800 flex-1">@P.PermanentAddress</span>
                                            </div>
                                            <div class="flex">
                                                <span class="text-gray-500 w-32 text-sm font-medium">Mobile:</span>
                                                <span class="text-gray-800 flex-1">@C.MobileNumber</span>
                                            </div>
                                            <div class="flex">
                                                <span class="text-gray-500 w-32 text-sm font-medium">Email:</span>
                                                <span class="text-gray-800 flex-1">@C.EmailAddress</span>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                        }
                        @if (AcademicInformation is not null)
                        {
                            foreach (var A in AcademicInformation)
                            {


                            
                                <div>
                                    <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                        <span class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">3</span>
                                        Academic Information
                                    </h2>
                                    <div class="space-y-3">
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Student Type:</span>
                                            <span class="text-gray-800 flex-1">@A.StudentType.GetDisplayName()</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Year Level:</span>
                                            <span class="text-gray-800 flex-1">@A.YearLevel.GetDisplayName()</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Semester:</span>
                                            <span class="text-gray-800 flex-1">@A.Semester.GetDisplayName()</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">Program:</span>
                                            <span class="text-gray-800 flex-1">@A.Program.GetDisplayName()</span>
                                        </div>
                                        <div class="flex">
                                            <span class="text-gray-500 w-32 text-sm font-medium">SHS Strand:</span>
                                            <span class="text-gray-800 flex-1">@A.Strand.GetDisplayName()</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </div>

               
                <div class="w-[100%] lg:w-[55%]  bg-white rounded-lg shadow-md overflow-y-auto h-[90%]">

                    <div class=" sticky h-25 top-0 bg-gradient-to-l from-cyan-600 to-teal-700 p-6 rounded-t-lg">
                        <h1 class="text-2xl font-bold text-white">Course Selection & Invoice</h1>
                        <p class="text-blue-100 mt-1 text-sm">Review your selected course and payment details</p>
                    </div>

                    <div class="p-6">

                        <div class="mb-6">
                            <h2 class="text-lg font-bold text-gray-700 mb-4">Selected Course</h2>


                            <div class="border-1 border-teal-400 bg-teal-50 rounded-lg p-5 shadow-sm">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">@PreviewCourse?.Title</h3>
                                        <p class="text-sm text-gray-600 mt-1">@PreviewCourse?.CourseCode • @PreviewCourse?.Unit Units</p>
                                    </div>
                                    <button class="text-red-500 hover:text-red-700 text-sm font-medium">Remove</button>
                                </div>

                                <p class="text-gray-700 text-sm mb-4">@PreviewCourse?.CourseDescriptiion</p>

                                <div class="flex gap-2 mb-4 flex-wrap">
                                    <span class="bg-teal-100 text-teal-700 px-3 py-1 rounded-full text-xs font-medium">@PreviewCourse?.Department?.GetDisplayName()</span>
                                    <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs">@PreviewCourse?.Schedule</span>
                                    <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs">@PreviewCourse?.Room</span>
                                </div>

                                <div class="border-t border-teal-200 pt-3 mt-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 text-sm">Course Fee:</span>
                                        <span class="text-teal-600 font-bold text-2xl">₱ @PreviewCourse?.Cost</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                       
                        <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                            <h2 class="text-lg font-bold text-gray-800 mb-5">Payment Invoice</h2>

                            <div class="space-y-3 mb-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Course Code:</span>
                                    <span class="font-medium text-gray-800">@PreviewCourse?.CourseCode</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Total Units:</span>
                                    <span class="font-medium text-gray-800">@PreviewCourse?.Unit Units</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Tuition Fee:</span>
                                    <span class="font-medium text-gray-800">₱ @PreviewCourse?.Cost</span>
                                </div>

                                <div class="border-t-2 border-gray-300 pt-4 mt-4 flex justify-between">
                                    <span class="font-bold text-gray-800 text-lg">Total Amount:</span>
                                    <span class="font-bold text-teal-600 text-2xl">₱ @PreviewCourse?.Cost</span>
                                </div>
                            </div>

                            <div class="bg-cyan-50 border border-cyan-200 rounded-lg p-3 mb-4">
                                <p class="text-xs text-cyan-800">
                                    <strong>Note:</strong> Payment must be completed within 48 hours to secure your enrollment.
                                </p>
                            </div>
                       
                            <button onclick="my_modal_payment.showModal()" class=" w-full bg-teal-600 text-white py-3 rounded-lg hover:bg-teal-700 transition-colors font-bold shadow-md">
                                Proceed to Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>









            <PurchaseConfirmation PreviewCourse="PreviewCourse" />
            <EnrollmentEditInformation PersonalInformation="PersonalInformation" AcademicInformation="AcademicInformation" ContactInformation="ContactInformation" />

        </div>
        <div class="drawer-side">
            <label for="my-drawer-2" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu min-h-full w-62 p-4 text-white" style="background: radial-gradient(at 0% 0%, rgb(6, 182, 212) 0px, transparent 50%), radial-gradient(at 100% 100%, rgb(14, 116, 144) 0px, transparent 50%), radial-gradient(at 100% 0%, rgb(8, 145, 178) 0px, transparent 50%), radial-gradient(at 0% 100%, rgb(21, 94, 117) 0px, transparent 50%), rgb(17, 24, 39);">
              
                <li class="mx-auto mb-4">
                    <div class="w-[92px] h-[92px]  border-4 border-amber-500 rounded-full  flex items-center justify-center overflow-hidden bg-white">
                        <img src="/img/student_logo.jpg" class="w-full h-full object-contain" />
                    </div>
                </li>
                <li><a class="text-white text-2xl font-light btn btn-outline btn-primary">Enrollment</a></li>


                <li class="mt-10"><NavLink href="/paymenthistory" class="text-white text-md btn-[40%] font-semibold btn btn-outline btn-primary">Payment History</NavLink></li>
                <li class="mt-2"><a class="text-white text-md btn-[40%] font-semibold btn btn-outline btn-primary">Settings</a></li>
                <li class="mt-2"><a class="text-white text-md btn-[40%] font-semibold btn btn-outline btn-primary">Logout</a></li>

                <li class="mt-10"><NavLink href="/profileinformation" class="text-white text-md btn-[40%] font-semibold btn btn-outline btn-primary">Profile</NavLink></li>
                <li class="mt-2"><NavLink href="/announcement" class="text-white text-md btn-[40%] font-semibold btn btn-outline btn-primary">Announcements</NavLink></li>
                <li class="mt-2"><NavLink href="/enrolledcourse" class="text-white text-md btn-[40%] font-semibold btn btn-outline btn-primary">Enrolled Course</NavLink></li>
            </ul>
        </div>
    </div>





</div>
@code {
    [Parameter]
    public Guid CouresId { get; set; }
    public bool hasrender = false;

    public IEnumerable<PersonalInformationDto>? PersonalInformation { get; set; }
    public IEnumerable<AcademicInformationDto>? AcademicInformation { get; set; }
    public IEnumerable<ContactInformationDto>? ContactInformation { get; set; }

    public CourseDto? PreviewCourse { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(!hasrender && firstRender)
        {
            hasrender = true;
            PersonalInformation = await studentRecordCommand.DisplayPersonalInformationAsync();
            AcademicInformation = await studentRecordCommand.DisplayAcademicInformation();
            ContactInformation = await studentRecordCommand.DisplayContactInformationAsync();
            PreviewCourse = await enrollmentApiServices.PreviewCourseAsync(CouresId);
        }
        StateHasChanged();
    }
}
