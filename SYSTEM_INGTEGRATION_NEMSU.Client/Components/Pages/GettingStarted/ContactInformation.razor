@using SYSTEM_INGTEGRATION_NEMSU.Domain.DTOs.Student_RecordDtos
@using SYSTEM_INGTEGRATION_NEMSU.Domain.Entities.Student_Rcord
@inject PageState pageState
@inject IStudentRecordApiCommand studentRecordApi

<div class="space-y-4">
    <div class="text-center mb-6">
        <div class="w-14 h-14 bg-gradient-to-br from-cyan-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
        </div>
        <h2 class="text-xl font-bold text-slate-600 mb-1">Contact Information</h2>
        <p class="text-sm text-slate-500">Provide your contact details for communication</p>
    </div>

    <EditForm Model="@contactInformation" OnValidSubmit="@HandleContactInformation" FormName="Contact">
        <div class="space-y-5">

           
            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200">
                <label class="block text-sm font-semibold text-slate-600 mb-3">Personal Mobile Number</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3.5 pointer-events-none">
                        <svg class="w-5 h-5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M7.25 11.5C6.83579 11.5 6.5 11.8358 6.5 12.25C6.5 12.6642 6.83579 13 7.25 13H8.75C9.16421 13 9.5 12.6642 9.5 12.25C9.5 11.8358 9.16421 11.5 8.75 11.5H7.25Z" />
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M6 1C4.61929 1 3.5 2.11929 3.5 3.5V12.5C3.5 13.8807 4.61929 15 6 15H10C11.3807 15 12.5 13.8807 12.5 12.5V3.5C12.5 2.11929 11.3807 1 10 1H6ZM10 2.5H9.5V3C9.5 3.27614 9.27614 3.5 9 3.5H7C6.72386 3.5 6.5 3.27614 6.5 3V2.5H6C5.44771 2.5 5 2.94772 5 3.5V12.5C5 13.0523 5.44772 13.5 6 13.5H10C10.5523 13.5 11 13.0523 11 12.5V3.5C11 2.94772 10.5523 2.5 10 2.5Z" />
                        </svg>
                    </span>
                    <input @bind="contactInformation.MobileNumber" type="tel"
                           class="w-full pl-11 pr-3 py-3 bg-white border border-slate-300 rounded-lg text-sm font-medium
                                  focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all
                                  hover:border-slate-400"
                           required
                           placeholder="09XX XXX XXXX"
                           pattern="[0-9]*"
                           minlength="11"
                           maxlength="11" />
                </div>
                <div class="flex items-center gap-2 mt-2">
                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-xs text-slate-500">11-digit Philippine mobile number (e.g., 09171234567)</p>
                </div>
            </div>

      
            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200">
                <label class="block text-sm font-semibold text-slate-600 mb-3">Email Address</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3.5 pointer-events-none">
                        <svg class="w-5 h-5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                    </span>
                    <input @bind="contactInformation.EmailAddress" type="email"
                           class="w-full pl-11 pr-3 py-3 bg-white border border-slate-300 rounded-lg text-sm font-medium
                                  focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all
                                  hover:border-slate-400"
                           required
                           placeholder="your.email@example.com" />
                </div>
                <div class="flex items-center gap-2 mt-2">
                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-xs text-slate-500">Used for official university communications and notifications</p>
                </div>
            </div>

          
            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200">
                <label class="block text-sm font-semibold text-slate-600 mb-3">Emergency Contact Number</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3.5 pointer-events-none">
                        <svg class="w-5 h-5 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </span>
                    <input @bind="contactInformation.EmergencyContactNumber" type="tel"
                           class="w-full pl-11 pr-3 py-3 bg-white border border-slate-300 rounded-lg text-sm font-medium
                                  focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all
                                  hover:border-slate-400"
                           required
                           placeholder="09XX XXX XXXX"
                           pattern="[0-9]*"
                           minlength="11"
                           maxlength="11" />
                </div>
                <div class="flex items-center gap-2 mt-2">
                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-xs text-slate-500">Parent or guardian contact number in case of emergency</p>
                </div>
            </div>

         
            <div class="bg-gradient-to-r from-cyan-50 to-teal-50 border-2 border-cyan-200 rounded-xl p-4">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 bg-cyan-600 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                    <div>
                        <h4 class="text-sm font-bold text-cyan-900 mb-1.5">Data Privacy & Security</h4>
                        <p class="text-xs text-cyan-800 leading-relaxed">Your contact information is protected under the Data Privacy Act of 2012. We will only use this information for official university purposes and emergency communications. Your data will not be shared with third parties without your consent.</p>
                    </div>
                </div>
            </div>

       
            @if (!string.IsNullOrEmpty(Error))
            {
                <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div>
                            <h5 class="text-sm font-semibold text-red-900">Submission Error</h5>
                            <p class="text-sm text-red-800">@Error</p>
                        </div>
                    </div>
                </div>
            }

          
            <div class="flex flex-col sm:flex-row justify-between gap-3 pt-6 border-t-2 border-slate-200">
                <button type="button" @onclick="()=> HandleSaveAsDraft()"
                        class="flex-1 px-4 py-2.5 text-sm  bg-white border border-slate-300 text-slate-700 rounded-lg font-medium
                               hover:bg-slate-50 hover:border-slate-400 transition-all shadow-sm
                               flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                    </svg>
                    Save as Draft
                </button>
                <button type="submit"
                        class="flex-1 px-4 py-2.5 bg-gradient-to-br from-cyan-600 to-teal-600 text-white rounded-lg font-medium
                               hover:from-cyan-700 text-sm hover:to-teal-800 transition-all shadow-lg hover:shadow-xl
                               flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Save 
                </button>
            </div>
        </div>
    </EditForm>
</div>

@code {
    public ContactInformationDto contactInformation { get; set; } = new();
    public string? Error { get; set; }

    public async Task HandleContactInformation()
    {
        contactInformation.Savestatus = SaveStatusContact.Save;
        var results = await studentRecordApi.AddContactInformationAsync(contactInformation);
        if (results is null)
        {
            Error = "Fill up All Requirements";
        }
        pageState.SetViewContact(PageState.SaveAsDraftContact.Save);
    }

    public async Task HandleSaveAsDraft()
    {
        contactInformation.Savestatus = SaveStatusContact.Save_As_Draft;
        var results = await studentRecordApi.AddContactInformationAsync(contactInformation);
        if (results is null)
        {
            Error = "Fill up All Requirements";
        }
        pageState.SetViewContact(PageState.SaveAsDraftContact.SaveASDraft);
    }
}